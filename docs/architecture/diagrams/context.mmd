flowchart LR
  Client[Clients] -->|HTTP| GW[api.gateway]
  GW -->|gRPC| ID[identity]
  GW -->|gRPC| WR[wiki-write]
  GW -->|gRPC| RD[wiki-read]
  GW -->|gRPC| MED[media]
  GW -->|gRPC| SRCH[search]

  WR --> MONGO[(MongoDB)]
  RD --> MONGO
  ID --> MONGO
  MED --> MONGO

  RD --> REDIS[(Redis)]
  GW --> REDIS

  MED --> S3[(Yandex Object Storage)]
  SRCH --> OS[(OpenSearch/Elasticsearch)]

  WR --> OUT[Outbox (MongoDB)];
  OUT --> RENDER[render worker];
  OUT --> SRCHIDX[search indexer];
  OUT --> MEDW[media worker];

  RENDER --> MONGO;
  SRCHIDX --> OS;
  MEDW --> S3;

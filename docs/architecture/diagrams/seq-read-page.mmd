sequenceDiagram
  autonumber
  participant C as Client
  participant G as api.gateway
  participant R as wiki-read
  participant K as Redis
  participant M as Mongo (read-model)

  C->>G: GET /v1/wiki/pages/{id}
  G->>G: verify JWT, set request_id
  G->>R: gRPC GetPage (metadata: user_id, roles, request_id)
  R->>K: GET page:{id}:{head_rev}
  alt cache hit
    K-->>R: snapshot
    R-->>G: PageResponse
  else cache miss
    R->>M: find page_head(id) + snapshot(id, rev)
    M-->>R: documents
    R->>K: SET snapshot (immutable key)
    R-->>G: PageResponse
  end
  G-->>C: 200 + ETag(revision_id)
